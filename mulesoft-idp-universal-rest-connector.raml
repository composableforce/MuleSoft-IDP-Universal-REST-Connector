#%RAML 1.0
title: MuleSoft IDP Universal üåê REST Connector üîå
version: v1
mediaType: application/json
protocols: HTTPS
securedBy: mulesoft-connectedApp-oauth

baseUri: https://idp-rt.{region}.anypoint.mulesoft.com
baseUriParameters:
  region:
    type: field-runtimeRegion

/api/{apiVersion}/organizations/{orgId}/actions/{actionId}/versions/{actionVersion}/executions:
  uriParameters:
    apiVersion:
      type: field-runtimeServiceApiVersion
    orgId:
      type: field-orgId
    actionId:
      type: field-actionId
    actionVersion:
      type: field-actionVersion

  post:
    displayName: ü§ñ IDP postDocumentActionExecution
    description: Submits a file for IDP processing
    body:
      multipart/form-data:
        type: any
        example:

          ------WebKitFormBoundary2Iqii0OMIdEA33iA
Content-Disposition: form-data; name="callback"
Content-Type: text/plain

{"noAuthUrl": "https://enny4ln4hb1v.x.pipedream.net/"}
------WebKitFormBoundary2Iqii0OMIdEA33iA
Content-Disposition: form-data; name="file"; filename="IDP-PO-CD656092-BurlingtonTextiles.pdf"
Content-Type: application/pdf

%PDF-1.7
‚Ä¶‚Ä¶ DELETED for BREVITY‚Ä¶‚Ä¶
%ÔøΩÔøΩÔøΩÔøΩ
1 0 obj
<</Pages 2 0 R /Type/Catalog>>
%%EOF

------WebKitFormBoundary2Iqii0OMIdEA33iA--
          
    responses:
      201:
        description: Created
        body:
          application/json: object-DocumentExecutionPostResponse
      400:
        description: Bad Request
        body:
          application/problem+json:
            type: object-commonError
      406:
        description: Not Acceptable
        body:
          application/problem+json:
            type: object-commonError
      500:
        description: Internal Server Error
        body:
          application/problem+json:
            type: object-commonError

  /{execution-id}:
    uriParameters:
      execution-id:
        type: field-executionId
    get:
      displayName: ü§ñ IDP getDocumentActionExecution
      description: Retrieves the State & Result Data of a document action execution.
      queryParameters:
        valueOnly:
          description: üö® Un-supported so use with Caution - Return Confidence levels when set to false
          type: field-valueOnly
          required: false
      responses:
        200:
          description: Success
          body:
            application/json: object-DocumentExecutionGetResponse
        404:
          description: Not Found
          body:
            application/problem+json:
              type: object-commonError
        406:
          description: Not Acceptable
          body:
            application/problem+json:
              type: object-commonError
        429:
          description: Too Many Requests
          body:
            application/problem+json:
              type: object-commonError

securitySchemes:
  mulesoft-connectedApp-oauth:
    displayName: üõ°Ô∏è MuleSoft Connected App OAuth 2.0
    type: OAuth 2.0
    description: |

        ### [Configure Connected Apps](https://docs.mulesoft.com/idp/automate-document-processing-with-the-idp-api#create-a-connected-app)

        ```
          curl --location --request POST 'https://anypoint.mulesoft.com/accounts/api/v2/oauth2/token' \ 
          --header 'Content-Type: application/json' \
          --data-raw '{
            "grant_type": "client_credentials",
            "client_id": "<connected-app-client-id>", 
            "client_secret": "<connected-app-client-secret>" 
          }'
        ```
    settings:
      accessTokenUri: https://anypoint.mulesoft.com/accounts/api/v2/oauth2/token
      authorizationGrants: 
        - client_credentials
    describedBy:
      headers:
        Authorization:
          description: |
            Used to send a valid OAuth 2 access token. Bearer 234235246236236326
          type: string
          example: Bearer 0695bab3-e776-4d33-b61d-092789cb8765
          pattern: ^Bearer [{]?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}[}]?$
      responses:
        401:
          description: |
            Bad or expired token. This can happen if the API consumer uses a revoked or expired access token. To fix, you should re-authenticate the user.
          body:
            application/problem+json:
              type: object-commonError
        403:
          description: |
            Bad OAuth request (wrong consumer key, bad nonce, expired timestamp...). Unfortunately, re-authenticating the user won't help here.
          body:
            application/problem+json:
              type: object-commonError


types:

  field-runtimeRegion:
    displayName: IDP Runtime Region
    description: |
      Currently supported IDP Runtime Regions
      - us-east-1
      - eu-central-1
    type: string
    enum:
      - us-east-1
      - eu-central-1
    default: us-east-1
    pattern: ^[a-z]{2}-[a-z]+-\d+$

  field-runtimeServiceApiVersion:
    displayName: IDP Runtime Service API Version
    description: Current version of the MuleSoft IDP Runtime Service API Version
    type: string
    enum:
      - v1
    default: v1
    maxLength: 2
    minLength: 2
    pattern: ^v[0-9]$

  field-orgId:
    displayName: MuleSoft Anypoint Organization Id
    description: |
      Your Anypoint Organisation Id see: [Find your Organization ID.](https://docs.mulesoft.com/access-management/organization#find-your-organization-id)
    example: eca25329-9592-4ff1-9054-1b08d103b991
    pattern: ^[{]?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}[}]?$
  field-actionId:
    displayName: IDP Document Action Id
    description: Published Document Action UUID
    default: 90c3e286-72b5-42ca-92d0-22f86ea8d766
    example: 90c3e286-72b5-42ca-92d0-22f86ea8d766
    type: string
    pattern: ^[{]?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}[}]?$

  object-callback:
    displayName: IDP Callback noAuthUrl Object
    description: Optional Callback https://docs.mulesoft.com/idp/automate-document-processing-with-the-idp-api#callback-url 
    properties:
      noAuthUrl:
        description: Your Callback URL to be used by IDP which can include query params
        example: https://yourCallbackURL.com?youCanUseQueryParms=SomeGreatValue&apikey=43243442342424
        type: string
    additionalProperties: false

  field-valueOnly:
    displayName: üö® Un-supported - valueOnly
    description: üö® Un-supported so use with Caution - Return Confidence levels when set to false, default behaviour is true so DONT SET
    type: boolean
    example: false

  field-actionVersion:
    displayName: IDP Document Action Id Version
    description: Document Action Version like 1.0.0
    default: 1.1.0
    example: 1.1.0
    type: string
    pattern: ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9A-Za-z-][0-9A-Za-z-]*)(?:\.(?:0|[1-9A-Za-z-][0-9A-Za-z-]*))*))?(?:\+([0-9A-Za-z-]+(?:\.[0-9A-Za-z-]+)*))?$

  field-executionId:
    displayName: IDP Execution Id
    description: IDP Execution Id returned after successful submission
    default: 022c61de-9bfc-4a94-8a9c-43c5f8ac153e
    example: 022c61de-9bfc-4a94-8a9c-43c5f8ac153e
    type: string
    pattern: ^[{]?[0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12}[}]?$

  field-ExecutionStatus:
    displayName: IDP Execution Status
    description: |
      ## [Execution Results Reference](https://docs.mulesoft.com/idp/automate-document-processing-with-the-idp-api#execution-status-reference).

      When you query the results of an execution, the IDP API returns the status which can be any of the following:

      - `ACKNOWLEDGED`: The document action execution request was received.
      - `IN_PROGRESS`: The execution started.
      - `RESULTS_PENDING`: The execution finished and IDP is processing the results.
      - `MANUAL_VALIDATION_REQUIRED`: The execution finished but the results need manual validation.
      - `FAILED`: The execution request finished unsuccessfully.
      - `PARTIAL_SUCCESS`: The execution request finished but some sub-tasks failed.
      - `SUCCEEDED`: The execution request finished successfully.
    default: IN_PROGRESS
    enum:
      - ACKNOWLEDGED
      - IN_PROGRESS
      - RESULTS_PENDING
      - MANUAL_VALIDATION_REQUIRED
      - FAILED
      - PARTIAL_SUCCESS
      - SUCCEEDED
    example: IN_PROGRESS
    type: string

  object-DocumentExecutionPostResponse:
    displayName: IDP Document Submission Response Object
    description: 
    type: object
    properties:
      id:
        type: field-executionId
        required: true
      documentName:
        description: Document Name and Extension
        type: string
        example: IDP-PO-CD656092-BurlingtonTextiles.pdf
        required: true
      status:
        type: field-ExecutionStatus
        required: false
    additionalProperties: false
    example: {"id": "af78b8b2-3867-4073-aac6-d24e01f48ae2","documentName": "IDP-PO-CD656092-BurlingtonTextiles.pdf"}

  object-DocumentExecutionGetResponse:
    displayName: IDP Retrieve Execution Response Object
    type: object
    description:
    properties:
      pages?:
        type: array
        items: Page
      id?:
        type: field-executionId
      documentName?:
        type: string
      prompts?:
        type: Prompt
      status?:
        type: field-ExecutionStatus
  Page:
    displayName: IDP Retrieve Execution Response Page Object
    type: object
    properties:
      tables?:
        type: object
        properties: {}
      page?:
        type: string
      fields?:
        type: object
        properties: {}
      prompts?:
        type: Prompt
  Prompt:
    displayName: IDP Retrieve Execution Response Prompt Object
    type: object
    properties:
      answer?: Field
      source?:
        type: string
      prompt?:
        type: string
  Field:
    displayName: IDP Retrieve Execution Response Field Object
    type: object
    properties:
      value?:
        type: string
      geometry?:
        type: object
        properties:
          height:
            type: number
            required: false
          left:
            type: number
            required: false
          width:
            type: number
            required: false
          top:
            type: number
            required: false
      confidenceScore?:
        type: number

  object-commonError:
    displayName: üÜò IDP Common Error Response
    description: IDP Common Error Response
    properties:
      status:
        description: HTTP response status codes
        default: 404
        example: 404
        type: number
        format: int
        required: true
      title:
        description: Error Title
        example: Not Found
        type: string
        required: true
      detail:
        description: Error Details if available
        example: "Action Id: 90c3e286-72b5-42ca-92d0-22f86ea8d766, Version: 1.1.0, Execution Id: 022c61de-9bfc-4a94-8a9c-43c5f8ac1531"
        type: string
        required: false
    example: {"status": 404,"title": "Not Found"}
    additionalProperties: false

description: |

  mediaType: application/json

  protocols: HTTPS

  securedBy: üõ°Ô∏è MuleSoft Connected App OAuth 2.0

  | Author | Date | Description
  | -------- | ------- | ------- |
  | G.Jeffcock | 23rd June 2024 | Launched| 
  |||| 
  ||||

  **IDP Runtime Service API connector**

  **Integrating IDP with Anypoint Studio**

  Execute a published document action and retrieve the results from Anypoint Studio using that document action‚Äôs IDP Runtime Service API connector. This connector generates automatically when you publish a document action to Anypoint Exchange. Then, you can download it as a Mule connector from Exchange.

  Each document action version generates a different connector. For example, when you publish a document action for the first time, it generates a connector in Exchange that executes version `1.0.0` of this document action. Then, if you modify the document action and republish it as version `1.1.0`, it generates a different connector that you must download and install in Studio to execute this new document action version. Consider this behavior when building your integrations.

  The IDP Runtime Service API connector has the following operations:

  - **getDocumentActionExecution**Retrieves the result of a document action execution.
  - **postDocumentActionExecution**Submits a document to IDP for processing.

documentation:
 - title: üìå Why?
   content: |
     ### MuleSoft IDP Universal üåê REST Connector üîå

 - title: üìå How?
   content: |
     ### MuleSoft IDP Universal üåê REST Connector üîå
